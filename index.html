<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Army Of Morr</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
    <!-- Game code -->
    <script>
        var config = {
            type: Phaser.AUTO,
            width: 640,
            height: 1200,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 0 },
                    debug: true,
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };
    
        var game = new Phaser.Game(config)
        var player, cursors, enemy

        //Preload
        function preload (){
            //Player
            this.load.image('player', './img/player.png')

            //Enemy
            this.load.image('enemy-1', './img/enemy-1.png')

            //Misc
            this.load.image('map', './img/map.png')
        }
    
        //Creates element
        function create (){
            //Variables for screen centre
            const screenCenterX = this.cameras.main.worldView.x + this.cameras.main.width / 2;
            const screenCenterY = this.cameras.main.worldView.y + this.cameras.main.height / 2;

            //Background image
            this.add.image(375, 812, 'map')

            //Player srite
            player = this.physics.add.sprite(screenCenterX, screenCenterY, 'player')
            player.setCollideWorldBounds(true);
            console.log(player)

            //Enemy sprites
            enemy = this.physics.add.group({
                key: 'enemy-1',
                repeat: 3,
                setXY: { x: 24, y: 24, stepX: 80, stepY: 12 },
                bounce: 1
            })

            enemy.children.forEach( function(elem){
                elem.setBounce(1)
            })

            console.log(enemy)

            //Keyboard keys
            cursors = this.input.keyboard.createCursorKeys()
        }
        
        //Updated elemen
        function update (){
            // console.log(player.body.velocity.x)

            //Player movement wihth keyboard
            if (cursors.left.isDown) {
                // player.x -= 3
                player.setVelocityX(-160)

                //Turn drift
                if(player.body.velocity.y > 0){
                    player.setVelocityY(player.body.velocity.y - 5)
                }
                else if (player.body.velocity.y < 0) {
                    player.setVelocityY(player.body.velocity.y + 5)
                }

            }
            else if (cursors.right.isDown) {
                player.setVelocityX(160)

                //Turn drift
                if(player.body.velocity.y > 0){
                    player.setVelocityY(player.body.velocity.y - 5)
                }
                else if (player.body.velocity.y < 0) {
                    player.setVelocityY(player.body.velocity.y + 5)
                }
            }
            else if (cursors.up.isDown) {
                player.setVelocityY(-160)

                if(player.body.velocity.x > 0){
                    player.setVelocityX(player.body.velocity.x - 5)
                }
                else if (player.body.velocity.x < 0) {
                    player.setVelocityX(player.body.velocity.x + 5)
                }
            }
            else if (cursors.down.isDown) {
                player.setVelocityY(160)

                if(player.body.velocity.x > 0){
                    player.setVelocityX(player.body.velocity.x - 5)
                } 
                else if (player.body.velocity.x < 0) {
                    player.setVelocityX(player.body.velocity.x + 5)
                }
            }
            else {
                player.setVelocityX(0)
                player.setVelocityY(0)
            }

            //Enemy movement
            enemy.children.entries.forEach(function(element){

                if (player.x > element.x){
                    element.x++
                }
                else if (player.x < element.x){
                    element.x--
                }
    
                if (player.y > element.y){
                    element.y++
                }
                else if (player.y < element.y){
                    element.y--
                }
            })
        }
    </script>

    <!-- Styles that center the canvas and set scaling ot 0.5 -->
    <style>
        body{
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas{
            transform: scale(0.5);
        }
    </style>
</body>
</html>